angular.module("ivh.treeview",[]),angular.module("ivh.treeview").constant("ivhTreeviewInterpolateEndSymbol","}}"),angular.module("ivh.treeview").constant("ivhTreeviewInterpolateStartSymbol","{{"),angular.module("ivh.treeview").directive("ivhTreeviewCheckboxHelper",[function(){"use strict";return{restrict:"A",scope:{node:"=ivhTreeviewCheckboxHelper"},require:"^ivhTreeview",link:function(a,b,c,d){var e=a.node,f=d.opts(),g=f.indeterminateAttribute,h=f.selectedAttribute;a.isSelected=e[h],a.trvw=d,a.resolveIndeterminateClick=function(){e[g]&&d.select(e,!0)},a.$watch("node."+h,function(b,c){a.isSelected=b}),a.$watch("node."+g,function(a,c){b.find("input").prop("indeterminate",a)})},template:['<input type="checkbox"','class="ivh-treeview-checkbox"','ng-model="isSelected"','ng-click="resolveIndeterminateClick()"','ng-change="trvw.select(node, isSelected)" />'].join("\n")}}]),angular.module("ivh.treeview").directive("ivhTreeviewCheckbox",[function(){"use strict";return{restrict:"AE",require:"^ivhTreeview",template:'<span ivh-treeview-checkbox-helper="node"></span>'}}]),angular.module("ivh.treeview").directive("ivhTreeviewChildren",function(){"use strict";return{restrict:"AE",require:"^ivhTreeviewNode",template:['<ul ng-if="getChildren().length" class="ivh-treeview">','<li ng-repeat="child in getChildren()"','ng-hide="trvw.hasFilter() && !trvw.isVisible(child)"','class="ivh-treeview-node"',"ng-class=\"{'ivh-treeview-node-collapsed': !trvw.isExpanded(child) && !trvw.isLeaf(child)}\"",'ivh-treeview-node="child"','ivh-treeview-depth="childDepth">',"</li>","</ul>"].join("\n")}}),angular.module("ivh.treeview").directive("ivhTreeviewNode",["ivhTreeviewCompiler",function(a){"use strict";return{restrict:"A",scope:{node:"=ivhTreeviewNode",depth:"=ivhTreeviewDepth"},require:"^ivhTreeview",compile:function(b){return a.compile(b,function(a,b,c,d){var e=a.node,f=a.getChildren=function(){return d.children(e)};a.trvw=d,a.childDepth=a.depth+1,d.isExpanded(e)||d.expand(e,d.isInitiallyExpanded(a.depth)),a.$watch(function(){return f().length>0},function(a){a?b.removeClass("ivh-treeview-node-leaf"):b.addClass("ivh-treeview-node-leaf")})})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewToggle",[function(){"use strict";return{restrict:"A",require:"^ivhTreeview",link:function(a,b,c,d){var e=a.node;b.addClass("ivh-treeview-toggle"),b.bind("click",function(){d.isLeaf(e)||a.$apply(function(){d.toggleExpanded(e),d.onToggle(e)})})}}}]),angular.module("ivh.treeview").directive("ivhTreeviewTwistie",["$compile","ivhTreeviewOptions",function(a,b){"use strict";var c=b();return{restrict:"A",require:"^ivhTreeview",template:['<span class="ivh-treeview-twistie">','<span class="ivh-treeview-twistie-collapsed">',c.twistieCollapsedTpl,"</span>",'<span class="ivh-treeview-twistie-expanded">',c.twistieExpandedTpl,"</span>",'<span class="ivh-treeview-twistie-leaf">',c.twistieLeafTpl,"</span>","</span>"].join("\n"),link:function(b,d,e,f){if(f.hasLocalTwistieTpls){var g=f.opts(),h=d.children().eq(0).children();angular.forEach(["twistieCollapsedTpl","twistieExpandedTpl","twistieLeafTpl"],function(d,e){var f=g[d],i=c[d];if(f&&f!==i){"<"===f.substr(0,1)&&">"===f.substr(-1,1)||(f="<span>"+f+"</span>");var j=a(f)(b);h.eq(e).html("").append(j)}})}}}}]),angular.module("ivh.treeview").directive("ivhTreeview",["ivhTreeviewMgr",function(a){"use strict";return{restrict:"A",transclude:!0,scope:{root:"=ivhTreeview",childrenAttribute:"=ivhTreeviewChildrenAttribute",defaultSelectedState:"=ivhTreeviewDefaultSelectedState",expandToDepth:"=ivhTreeviewExpandToDepth",idAttribute:"=ivhTreeviewIdAttribute",indeterminateAttribute:"=ivhTreeviewIndeterminateAttribute",expandedAttribute:"=ivhTreeviewExpandedAttribute",labelAttribute:"=ivhTreeviewLabelAttribute",nodeTpl:"=ivhTreeviewNodeTpl",selectedAttribute:"=ivhTreeviewSelectedAttribute",onCbChange:"&ivhTreeviewOnCbChange",onToggle:"&ivhTreeviewOnToggle",twistieCollapsedTpl:"=ivhTreeviewTwistieCollapsedTpl",twistieExpandedTpl:"=ivhTreeviewTwistieExpandedTpl",twistieLeafTpl:"=ivhTreeviewTwistieLeafTpl",useCheckboxes:"=ivhTreeviewUseCheckboxes",validate:"=ivhTreeviewValidate",visibleAttribute:"=ivhTreeviewVisibleAttribute",userOptions:"=ivhTreeviewOptions",filter:"=ivhTreeviewFilter"},controllerAs:"trvw",bindToController:!0,controller:["$scope","$attrs","$transclude","ivhTreeviewOptions","filterFilter",function(b,c,d,e,f){var g=angular,h=this,i=g.extend({},e(),h.userOptions);g.forEach(["childrenAttribute","defaultSelectedState","expandToDepth","idAttribute","indeterminateAttribute","expandedAttribute","labelAttribute","nodeTpl","selectedAttribute","twistieCollapsedTpl","twistieExpandedTpl","twistieLeafTpl","useCheckboxes","validate","visibleAttribute"],function(a){g.isDefined(h[a])&&(i[a]=h[a])});var j=function(a){return"ivhTreeview"+a.charAt(0).toUpperCase()+a.slice(1)};g.forEach(["onCbChange","onToggle"],function(a){c[j(a)]&&(i[a]=h[a])});var k;d(function(a,b){var c="";angular.forEach(a,function(a){c+=(a.innerHTML||"").trim()}),c.length&&(i.nodeTpl=c),k=b}),h.opts=function(){return i};var l=h.userOptions||{};h.hasLocalTwistieTpls=!!(l.twistieCollapsedTpl||l.twistieExpandedTpl||l.twistieLeafTpl||h.twistieCollapsedTpl||h.twistieExpandedTpl||h.twistieLeafTpl),h.children=function(a){var b=a[i.childrenAttribute];return g.isArray(b)?b:[]},h.label=function(a){return a[i.labelAttribute]},h.hasFilter=function(){return g.isDefined(h.filter)},h.getFilter=function(){return h.filter||""},h.isVisible=function(a){var b=h.getFilter();if(!b||f([a],b).length)return!0;if("object"==typeof b||"function"==typeof b)for(var c=h.children(a),d=c.length;d--;)if(h.isVisible(c[d]))return!0;return!1},h.shouldUseCheckboxes=function(){return i.useCheckboxes},h.select=function(b,c){a.select(h.root,b,i,c),h.onCbChange(b,c)},h.isSelected=function(a){return a[i.selectedAttribute]},h.toggleSelected=function(a){var b=!a[i.selectedAttribute];h.select(a,b)},h.expand=function(b,c){a.expand(h.root,b,i,c)},h.isExpanded=function(a){return a[i.expandedAttribute]},h.toggleExpanded=function(a){h.expand(a,!h.isExpanded(a))},h.isInitiallyExpanded=function(a){return a<(i.expandToDepth===-1?1/0:i.expandToDepth)},h.isLeaf=function(a){return 0===h.children(a).length},h.getNodeTpl=function(){return i.nodeTpl},h.getTranscludedNodeScope=function(){return k},h.getRoot=function(){return h.root},h.onToggle=function(a){if(i.onToggle){var b={ivhNode:a,ivhIsExpanded:h.isExpanded(a),ivhTree:h.root};i.onToggle(b)}},h.onCbChange=function(a,b){if(i.onCbChange){var c={ivhNode:a,ivhIsSelected:b,ivhTree:h.root};i.onCbChange(c)}}}],link:function(b,c,d){var e=b.trvw.opts();e.validate&&a.validate(b.trvw.root,e)},template:['<ul class="ivh-treeview">','<li ng-repeat="child in trvw.root | ivhTreeviewAsArray"','ng-hide="trvw.hasFilter() && !trvw.isVisible(child)"','class="ivh-treeview-node"',"ng-class=\"{'ivh-treeview-node-collapsed': !trvw.isExpanded(child) && !trvw.isLeaf(child)}\"",'ivh-treeview-node="child"','ivh-treeview-depth="0">',"</li>","</ul>"].join("\n")}}]),angular.module("ivh.treeview").filter("ivhTreeviewAsArray",function(){"use strict";return function(a){return!angular.isArray(a)&&angular.isObject(a)?[a]:a}}),angular.module("ivh.treeview").factory("ivhTreeviewBfs",["ivhTreeviewOptions",function(a){"use strict";var b=angular;return function(c,d,e){2===arguments.length&&b.isFunction(d)&&(e=d,d={}),d=angular.extend({},a(),d),e=e||b.noop;var f,g,h,i,j,k=[],l=d.childrenAttribute;for(b.isArray(c)?(b.forEach(c,function(a){k.push([a,[]])}),f=k.shift()):f=[c,[]];f;){if(g=f[0],h=f[1],e(g,h)!==!1&&g[l]&&b.isArray(g[l]))for(j=g[l].length,i=0;i<j;i++)k.push([g[l][i],[g].concat(h)]);f=k.shift()}}}]),angular.module("ivh.treeview").factory("ivhTreeviewCompiler",["$compile",function(a){"use strict";return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e;return{pre:c&&c.pre?c.pre:null,post:function(b,f,g,h){d||(d=a(h.getNodeTpl()),e=h.getTranscludedNodeScope()),d(b.$new(!1,e),function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]),angular.module("ivh.treeview").factory("ivhTreeviewMgr",["ivhTreeviewOptions","ivhTreeviewBfs",function(a,b){"use strict";var c=angular,d=a(),e={},f=function(a){a[this.selectedAttribute]=!1,a[this.indeterminateAttribute]=!1},g=function(a){a[this.selectedAttribute]=!0,a[this.indeterminateAttribute]=!1},h=function(a){var b=a[this.childrenAttribute],d=this.selectedAttribute,e=this.indeterminateAttribute,f=0,g=0;c.forEach(b,function(a,b){a[d]?f++:a[e]&&g++}),0===f&&0===g?(a[d]=!1,a[e]=!1):f===b.length?(a[d]=!0,a[e]=!1):(a[d]=!1,a[e]=!0)},i=function(a){return c.isString(a)||c.isNumber(a)},j=function(a,c,d,e){var f=i(c),g=!0,h=d.idAttribute,j=null,k=[];return b(a,d,function(a,b){return g&&(f?c===a[h]:c===a)&&(g=!1,j=a,k=b),g}),e(j,k)};return e.select=function(a,j,k,l){arguments.length>2&&"boolean"==typeof k&&(l=k,k={}),k=c.extend({},d,k),l=!c.isDefined(l)||l;var m=i(j),n=!0,o=k.idAttribute;return b(a,k,function(a,d){n&&(m?j===a[o]:j===a)&&(n=!1,b(a,k,l?g.bind(k):f.bind(k)),c.forEach(d,h.bind(k)));return n}),e},e.selectAll=function(a,f,g){arguments.length>1&&"boolean"==typeof f&&(g=f,f={}),f=c.extend({},d,f),g=!c.isDefined(g)||g;var h=f.selectedAttribute,i=f.indeterminateAttribute;return b(a,f,function(a){a[h]=g,a[i]=!1}),e},e.selectEach=function(a,b,d,f){return c.forEach(b,function(b){e.select(a,b,d,f)}),e},e.deselect=function(a,b,c){return e.select(a,b,c,!1)},e.deselectAll=function(a,b){return e.selectAll(a,b,!1)},e.deselectEach=function(a,b,c){return e.selectEach(a,b,c,!1)},e.validate=function(a,f,g){if(!a)return e;arguments.length>1&&"boolean"==typeof f&&(g=f,f={}),f=c.extend({},d,f),g=c.isDefined(g)?g:f.defaultSelectedState;var h=f.selectedAttribute,i=f.indeterminateAttribute;return b(a,f,function(b,d){if(c.isDefined(b[h])&&b[h]!==g)return e.select(a,b,f,!g),!1;b[h]=g,b[i]=!1}),e},e.expand=function(a,b,f,g){arguments.length>2&&"boolean"==typeof f&&(g=f,f={}),f=c.extend({},d,f),g=!c.isDefined(g)||g;var h=i(b),k=f.expandedAttribute;return h?j(a,b,f,function(a,b){return a[k]=g,e}):(b[k]=g,e)},e.expandRecursive=function(a,f,g,h){arguments.length>2&&"boolean"==typeof g&&(h=g,g={}),f=c.isDefined(f)?f:a,g=c.extend({},d,g),h=!c.isDefined(h)||h;var k,l=i(f),m=g.expandedAttribute;return l?j(a,f,g,function(a,b){k=a}):k=f,k&&b(k,g,function(a,b){a[m]=h}),e},e.collapse=function(a,b,c){return e.expand(a,b,c,!1)},e.collapseRecursive=function(a,b,c,d){return e.expandRecursive(a,b,c,!1)},e.expandTo=function(a,b,f,g){arguments.length>2&&"boolean"==typeof f&&(g=f,f={}),f=c.extend({},d,f),g=!c.isDefined(g)||g;var h=f.expandedAttribute,i=function(a){a[h]=g};return j(a,b,f,function(a,b){return c.forEach(b,i),e})},e.collapseParents=function(a,b,c){return e.expandTo(a,b,c,!1)},e}]),angular.module("ivh.treeview").provider("ivhTreeviewOptions",["ivhTreeviewInterpolateStartSymbol","ivhTreeviewInterpolateEndSymbol",function(a,b){"use strict";var c=a,d=b,e={idAttribute:"id",labelAttribute:"label",childrenAttribute:"children",selectedAttribute:"selected",expandToDepth:0,useCheckboxes:!0,validate:!0,indeterminateAttribute:"__ivhTreeviewIndeterminate",expandedAttribute:"__ivhTreeviewExpanded",defaultSelectedState:!0,twistieExpandedTpl:"(-)",twistieCollapsedTpl:"(+)",twistieLeafTpl:"o",nodeTpl:['<div class="ivh-treeview-node-content" title="{{trvw.label(node)}}">',"<span ivh-treeview-toggle>",'<span class="ivh-treeview-twistie-wrapper" ivh-treeview-twistie></span>',"</span>",'<span class="ivh-treeview-checkbox-wrapper" ng-if="trvw.shouldUseCheckboxes()"',"ivh-treeview-checkbox>","</span>",'<span class="ivh-treeview-node-label" ivh-treeview-toggle>',"{{trvw.label(node)}}","</span>","<div ivh-treeview-children></div>","</div>"].join("\n").replace(new RegExp("{{","g"),c).replace(new RegExp("}}","g"),d)};this.set=function(a){angular.extend(e,a)},this.$get=function(){return function(){return angular.copy(e)}}}]);